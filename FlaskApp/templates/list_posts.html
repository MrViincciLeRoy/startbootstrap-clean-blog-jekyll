{% extends "base.html" %}

{% block title %}All Posts - Blog Management{% endblock %}
{% block page_title %}All Blog Posts{% endblock %}

{% block content %}
<style>
    .post-card { 
        background: white; 
        border-radius: 8px; 
        padding: 1.5rem; 
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .post-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }
    .search-box {
        max-width: 300px;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">All Posts</h2>
        <small class="text-muted">Total: {{ posts|length }} posts</small>
    </div>
    <div class="input-group search-box">
        <input type="text" class="form-control" id="searchInput" placeholder="Search posts...">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
    </div>
</div>

<div id="postsContainer">
    {% if posts %}
        {% for post in posts %}
        <div class="post-card" data-post-name="{{ post.name|lower }}">
            <div class="d-flex justify-content-between align-items-start gap-3">
                <div class="flex-grow-1">
                    <h5 class="mb-2">
                        <i class="fas fa-file-alt text-primary"></i>
                        {{ post.name }}
                    </h5>
                    <small class="text-muted">
                        <i class="fas fa-database"></i> {{ (post.size / 1024)|round(1) }} KB
                        <span class="ms-2"><i class="fas fa-folder"></i> {{ post.path }}</span>
                    </small>
                </div>
                <div class="btn-group btn-group-sm">
                    <a href="{{ url_for('view_post', post_path=post.path) }}" 
                       class="btn btn-outline-info" title="View post">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="{{ url_for('edit_post', post_path=post.path) }}" 
                       class="btn btn-outline-primary" title="Edit post">
                        <i class="fas fa-edit"></i>
                    </a>
                    <button class="btn btn-outline-danger" 
                            onclick="deletePost('{{ post.path }}', '{{ post.name }}')"
                            title="Delete post">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-inbox fa-3x text-muted mb-3 d-block"></i>
            <p class="text-muted">No posts found</p>
        </div>
    {% endif %}
</div>

<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('input', function(e) {
        const search = e.target.value.toLowerCase();
        document.querySelectorAll('.post-card').forEach(card => {
            const name = card.dataset.postName;
            card.style.display = name.includes(search) ? 'block' : 'none';
        });
    });

    // Delete post
    function deletePost(path, name) {
        if (confirm(`Delete "${name}"?\n\nThis action will commit the deletion to GitHub.`)) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/post/${path}/delete`;
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}